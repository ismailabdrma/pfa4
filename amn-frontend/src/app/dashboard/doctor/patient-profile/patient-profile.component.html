<div class="p-6 space-y-6">
  <h2 class="text-2xl font-bold text-blue-900">Tableau de bord Médecin</h2>

  <!-- Recherche du patient -->
  <div class="grid gap-2">
    <input class="border p-2 rounded" [(ngModel)]="cin" placeholder="CIN du patient">
    <input class="border p-2 rounded" [(ngModel)]="fullName" placeholder="Nom complet du patient">
    <button class="bg-blue-600 text-white px-4 py-2 rounded w-fit" (click)="searchPatient()">Rechercher</button>
  </div>

  <!-- Formulaire manuel pour compléter les infos du patient -->
  <div *ngIf="showManualForm" class="bg-yellow-100 p-4 rounded shadow">
    <h3 class="font-semibold">Informations manquantes</h3>
    <input class="border p-2 w-full mb-2" [(ngModel)]="manualData.bloodType" placeholder="Groupe sanguin">
    <input class="border p-2 w-full mb-2" [(ngModel)]="manualData.birthDate" type="date">
    <input class="border p-2 w-full mb-2" [(ngModel)]="manualData.emergencyContact" placeholder="Contact d'urgence">
    <input class="border p-2 w-full mb-2" [(ngModel)]="manualData.allergies" placeholder="Allergies">
    <input class="border p-2 w-full mb-2" [(ngModel)]="manualData.chronicDiseases" placeholder="Maladies chroniques">
    <label><input type="checkbox" [(ngModel)]="manualData.hasHeartProblem"> Problèmes cardiaques</label>
    <label class="ml-4"><input type="checkbox" [(ngModel)]="manualData.hasSurgery"> Chirurgies</label>
    <button class="bg-green-600 text-white px-4 py-2 mt-3 rounded" (click)="submitManualFolder()">Enregistrer</button>
  </div>

  <!-- Affichage du profil complet -->
  <div *ngIf="patientProfile" class="bg-gray-50 border p-4 rounded shadow">
    <h3 class="text-lg font-bold text-blue-800">Profil du patient</h3>
    <p><strong>Nom :</strong> {{ patientProfile.fullName }}</p>
    <p><strong>CIN :</strong> {{ patientProfile.cin }}</p>
    <p><strong>Date de naissance :</strong> {{ patientProfile.birthDate }}</p>
    <p><strong>Groupe sanguin :</strong> {{ patientProfile.bloodType }}</p>
    <p><strong>Contact d'urgence :</strong> {{ patientProfile.emergencyContact }}</p>
    <p><strong>Téléphone :</strong> {{ patientProfile.phone }}</p>
    <p><strong>Adresse :</strong> {{ patientProfile.address }}</p>
    <p><strong>Allergies :</strong> {{ patientProfile.allergies }}</p>
    <p><strong>Maladies chroniques :</strong> {{ patientProfile.chronicDiseases }}</p>
    <p><strong>Problèmes cardiaques :</strong> {{ patientProfile.hasHeartProblem ? 'Oui' : 'Non' }}</p>
    <p><strong>Chirurgies :</strong> {{ patientProfile.hasSurgery ? 'Oui' : 'Non' }}</p>

    <!-- Ajout d'une consultation -->
    <div class="mt-4">
      <h4 class="font-semibold">Ajouter une consultation</h4>
      <input class="border p-2 w-full mb-2" [(ngModel)]="medicalRecord.reason" placeholder="Motif">
      <input class="border p-2 w-full mb-2" [(ngModel)]="medicalRecord.diagnosis" placeholder="Diagnostic">
      <textarea class="border p-2 w-full mb-2" [(ngModel)]="medicalRecord.notes" placeholder="Notes"></textarea>
      <button class="bg-blue-600 text-white px-4 py-2 rounded" (click)="createMedicalRecord()">Ajouter</button>
    </div>

    <!-- Ajout d'une prescription -->
    <div class="mt-4">
      <h4 class="font-semibold">Prescrire un traitement</h4>
      <input class="border p-2 w-full mb-2" [(ngModel)]="prescription.medicines" placeholder="Médicaments">
      <textarea class="border p-2 w-full mb-2" [(ngModel)]="prescription.instructions" placeholder="Instructions"></textarea>
      <button class="bg-green-600 text-white px-4 py-2 rounded" (click)="writePrescription()">Prescrire</button>
    </div>

    <!-- Upload de fichiers médicaux -->
    <div class="mt-4 border-t pt-4">
      <h4 class="font-semibold">Uploader des documents médicaux</h4>
      <div class="grid md:grid-cols-3 gap-4">
        <!-- Scan -->
        <div>
          <h5 class="font-bold text-blue-600">Scan</h5>
          <input class="border p-1 w-full mb-1" [(ngModel)]="scanPayload.title" placeholder="Titre">
          <input class="border p-1 w-full mb-1" [(ngModel)]="scanPayload.description" placeholder="Description">

          <button class="bg-blue-500 text-white px-2 py-1 rounded" (click)="uploadScan()">Uploader</button>
        </div>
        <!-- Analyse -->
        <div>
          <h5 class="font-bold text-green-600">Analyse</h5>
          <input class="border p-1 w-full mb-1" [(ngModel)]="analysisPayload.title" placeholder="Titre">
          <input class="border p-1 w-full mb-1" [(ngModel)]="analysisPayload.description" placeholder="Description">

          <button class="bg-green-500 text-white px-2 py-1 rounded" (click)="uploadAnalysis()">Uploader</button>
        </div>
        <!-- Chirurgie -->
        <div>
          <h5 class="font-bold text-red-600">Chirurgie</h5>
          <input class="border p-1 w-full mb-1" [(ngModel)]="surgeryPayload.title" placeholder="Type">
          <input class="border p-1 w-full mb-1" [(ngModel)]="surgeryPayload.description" placeholder="Description">

          <button class="bg-red-500 text-white px-2 py-1 rounded" (click)="uploadSurgery()">Uploader</button>
        </div>
      </div>
    </div>

    <!-- Historique -->
    <div class="mt-6">
      <h4 class="text-lg font-semibold">Historique médical</h4>

      <div *ngIf="patientProfile.medicalRecords?.length">
        <h5 class="font-medium">Consultations</h5>
        <ul class="list-disc ml-5">
          <li *ngFor="let r of patientProfile.medicalRecords">
            {{ r.creationDate }} - {{ r.reason }} - {{ r.diagnosis }}
          </li>
        </ul>
      </div>

      <div *ngIf="patientProfile.prescriptions?.length">
        <h5 class="font-medium">Prescriptions</h5>
        <ul class="list-disc ml-5">
          <li *ngFor="let p of patientProfile.prescriptions">
            {{ p.prescribedDate }} - {{ p.medicines }}
          </li>
        </ul>
      </div>

      <div *ngIf="patientProfile.scans?.length">
        <h5 class="font-medium">Scans</h5>
        <ul class="list-disc ml-5">
          <li *ngFor="let s of patientProfile.scans">
            <a class="text-blue-700 underline" (click)="viewScanDetails(s.id)">{{ s.title }} - {{ s.uploadDate }}</a>
          </li>
        </ul>
      </div>

      <div *ngIf="patientProfile.analyses?.length">
        <h5 class="font-medium">Analyses</h5>
        <ul class="list-disc ml-5">
          <li *ngFor="let a of patientProfile.analyses">
            <a class="text-green-700 underline" (click)="viewAnalysisDetails(a.id)">{{ a.title }} - {{ a.uploadDate }}</a>
          </li>
        </ul>
      </div>

      <div *ngIf="patientProfile.surgeries?.length">
        <h5 class="font-medium">Chirurgies</h5>
        <ul class="list-disc ml-5">
          <li *ngFor="let s of patientProfile.surgeries">
            <a class="text-red-700 underline" (click)="viewSurgeryDetails(s.id)">{{ s.title }} - {{ s.uploadDate }}</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
